---
title: "script3 - Tarefa 3"
output: html_document
author: Guilherme Gadelha
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Configura working directory e importa libs
```{r}

library(readr)
library(dplyr)
library(ISLR)
library(caret)

setwd("~/Desktop/Link to AD2/analytics2/Tarefa3")
```


## Importa dados limpos
```{r}
alunos.input <- read.table("alunos_model_input2.csv", sep=",", header = TRUE)

alunos.input <- alunos.input  %>%
  mutate(Cod_Evasao = as.integer(Cod_Evasao))

head(alunos.input)
n <- nrow(alunos.input)
```

## Cria conjuntos de treino e de teste
```{r}
trainIndex <- sample(1:n, size = round(0.7*n), replace= FALSE)
training <- alunos.input[ trainIndex, ]
testing <- alunos.input[ -trainIndex, ]

```

## Regressão logística com validação cruzada
```{r}
ctrl <- trainControl(method = "repeatedcv", number = 10, savePredictions = TRUE)

logistic_fit_1 <- train(Cod_Evasao ~ 
                   ÁLGEBRA.VETORIAL.E.GEOMETRIA.ANALÍTICA +
                   CALCULO.DIFERENCIAL.E.INTEGRAL.I +
                   CALCULO.DIFERENCIAL.E.INTEGRAL.II +
                   LEITURA.E.PRODUCAO.DE.TEXTOS +
                   MATEMÁTICA.DISCRETA +
                   PROGRAMAÇÃO.I +
                   PROGRAMAÇÃO.II +
                   INTRODUÇÃO.A.COMPUTAÇÃO +
                   LABORATÓRIO.DE.PROGRAMAÇÃO.I +
                   LABORATÓRIO.DE.PROGRAMAÇÃO.II +
                   TEORIA.DOS.GRAFOS,
                 data = training,
                 method = "glm",
                 family = "binomial",
                 trControl = ctrl, tuneLength = 5
                 )

exp(coef(logistic_fit_1$finalModel))

predict(logistic_fit_1, newdata=testing)
#predict(logistic_fit_1, newdata=testing, type="prob")

```


# --------------------------------------------------------------------------------------------------------------------
# 3. Usando todas as variáveis disponíveis (disciplinas do primeiro e segundo período), 
#     use validacao cruzada para tunar um modelo de regressão logística.

```{r}

logistic_fit <- glm(Cod_Evasao ~ 
                   ÁLGEBRA.VETORIAL.E.GEOMETRIA.ANALÍTICA +
                   CALCULO.DIFERENCIAL.E.INTEGRAL.I +
                   CALCULO.DIFERENCIAL.E.INTEGRAL.II +
                   LEITURA.E.PRODUCAO.DE.TEXTOS +
                   MATEMÁTICA.DISCRETA +
                   PROGRAMAÇÃO.I +
                   PROGRAMAÇÃO.II +
                   INTRODUÇÃO.A.COMPUTAÇÃO +
                   LABORATÓRIO.DE.PROGRAMAÇÃO.I +
                   LABORATÓRIO.DE.PROGRAMAÇÃO.II +
                   TEORIA.DOS.GRAFOS,
                 data = training)

summary(logistic_fit)
#exp(coef(logistic_fit$finalModel))

#predict(logistic_fit, newdata=testing)
#predict(logistic_fit, newdata=testing, type="prob")

```

## Importância de cada variável no modelo de regressão logística com validação cruzada
```{r}
varImp(logistic_fit)

```
### Como podemos observar, as disciplinas de Teoria dos Grafos e Matemática Discreta 
### têm baixa significância para o modelo final.


## Teste da qualidade do modelo de regressão logística
```{r}
library(MKmisc)
HLgof.test(fit = fitted(logistic_fit), obs = training$Cod_Evasao)

library(ResourceSelection)
hoslem.test(training$Cod_Evasao, fitted(logistic_fit), g=10)

```
### Segundo mostra o teste de Hosmer-Lemeshow, a hipótese nula é aceita, ou seja,
### o modelo é um bom fit dos dados (p-valor > 0.05).


## Árvores de Decisão
```{r}
library(rpart)

decision_tree_fit <- rpart(Cod_Evasao ~ 
               ÁLGEBRA.VETORIAL.E.GEOMETRIA.ANALÍTICA +
               CALCULO.DIFERENCIAL.E.INTEGRAL.I +
               CALCULO.DIFERENCIAL.E.INTEGRAL.II +
               LEITURA.E.PRODUCAO.DE.TEXTOS +
               MATEMÁTICA.DISCRETA +
               PROGRAMAÇÃO.I +
               PROGRAMAÇÃO.II +
               INTRODUÇÃO.A.COMPUTAÇÃO +
               LABORATÓRIO.DE.PROGRAMAÇÃO.I +
               LABORATÓRIO.DE.PROGRAMAÇÃO.II +
               TEORIA.DOS.GRAFOS,
             data = training,
             method="class")

plotcp(decision_tree_fit)
printcp(decision_tree_fit)
summary(decision_tree_fit)
```



## Florestas Randomicas
```{r}
library(randomForest)

training <- training %>% 
  mutate(Cod_Evasao = as.factor(Cod_Evasao))

rf_fit <- randomForest(Cod_Evasao ~ 
               ÁLGEBRA.VETORIAL.E.GEOMETRIA.ANALÍTICA +
               CALCULO.DIFERENCIAL.E.INTEGRAL.I +
               CALCULO.DIFERENCIAL.E.INTEGRAL.II +
               LEITURA.E.PRODUCAO.DE.TEXTOS +
               MATEMÁTICA.DISCRETA +
               PROGRAMAÇÃO.I +
               PROGRAMAÇÃO.II +
               INTRODUÇÃO.A.COMPUTAÇÃO +
               LABORATÓRIO.DE.PROGRAMAÇÃO.I +
               LABORATÓRIO.DE.PROGRAMAÇÃO.II +
               TEORIA.DOS.GRAFOS,
             data = training)
print(rf_fit)
importance(rf_fit)



```



## Comparação dos modelos de regressão logística com validação cruzada (logistic_fit) e
```{r}

```





